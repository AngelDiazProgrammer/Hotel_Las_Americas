<div th:fragment="vistaHuespedes" id="huespedes-container">

    <!-- Mensajes Flash -->
    <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
        <span th:text="${success}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
        <span th:text="${error}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <!-- Header con Bot칩n Agregar -->
    <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap">
        <h1>游낃 Gesti칩n de Huesped</h1>
        <div class="d-flex align-items-center gap-2">
            <span class="badge bg-primary">
                Total: <span th:text="${totalHuespedes}">0</span> Huesped
            </span>
            <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#modalCrear">
                <i class="fas fa-plus me-1"></i> Nueva Huesped
            </button>
        </div>
    </div>

    <!-- Tabla -->
    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
                <i class="fas fa-bed me-2"></i>
                Lista de Huespedes
            </h5>
            <small id="estadisticas" class="fst-italic"></small>
        </div>

        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-dark">
                    <tr>
                        <th>#</th>
                        <th>Cliente</th>
                        <th>Contacto</th>
                        <th>Documento</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                    </thead>

                    <tbody>
                    <tr th:each="huesped, stat : ${huespedes}">
                        <td th:text="${paginaActual * 10 + stat.index + 1}">1</td>
                        <td>
                            <strong th:text="${huesped.nombre + ' ' + huesped.apellido}"></strong>
                        </td>
                        <td>
                            <span th:text="${huesped.telefono}"></span>
                        </td>
                        <td>
    <span th:if="${huesped.idTipoDocumento == 1}"
          th:text="|C칠dula - ${huesped.documento}|">
    </span>

                            <span th:if="${huesped.idTipoDocumento == 2}"
                                  th:text="|Pasaporte - ${huesped.documento}|">
    </span>

                            <span th:if="${huesped.idTipoDocumento == 3}"
                                  th:text="|DNI - ${huesped.documento}|">
    </span>

                            <span th:if="${huesped.idTipoDocumento == null or huesped.idTipoDocumento == 0}"
                                  th:text="|Documento - ${huesped.documento}|">
    </span>
                        </td>
                        <td>
                                <span th:if="${huesped.idEstadoHuesped == 1}"
                                      class="badge bg-success">Activo</span>
                            <span th:if="${huesped.idEstadoHuesped == 2}"
                                  class="badge bg-success">En deuda</span>
                            <span th:if="${huesped.idEstadoHuesped == 3}"
                                  class="badge bg-success">En estadia</span>
                            <span th:if="${huesped.idEstadoHuesped == null or huesped.idEstadoHuesped == 0}"
                                  class="badge bg-success">Sin Estado</span>
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary btn-editar"
                                        data-bs-toggle="modal"
                                        data-bs-target="#modalEditar"
                                        th:data-id="${huesped.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-outline-info btn-ver"
                                        data-bs-toggle="modal"
                                        data-bs-target="#modalVer"
                                        th:data-id="${huesped.id}">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <!-- Vac칤o -->
            <div th:if="${huespedes.size() == 0}" class="text-center py-4">
                <i class="fas fa-bed fa-3x text-muted mb-3"></i>
                <h5 class="text-muted">No hay huespedes registradas</h5>
                <p class="text-muted">Agrega algunos huespedes para comenzar.</p>
            </div>

            <!-- Paginaci칩n -->
            <nav th:if="${totalPaginas > 1}" class="mt-3">
                <ul class="pagination justify-content-center">
                    <li class="page-item" th:classappend="${paginaActual == 0} ? 'disabled'">
                        <a class="page-link" href="javascript:void(0);"
                           th:onclick="'cargarComponenteConPagina(\'huespedes\', ' + (${paginaActual} - 1) + ')'">
                            Anterior
                        </a>
                    </li>

                    <li class="page-item"
                        th:each="i : ${#numbers.sequence(0, totalPaginas - 1)}"
                        th:classappend="${i == paginaActual} ? 'active'">
                        <a class="page-link" href="javascript:void(0);"
                           th:text="${i + 1}"
                           th:onclick="'cargarComponenteConPagina(\'huespedes\', ' + ${i} + ')'">
                        </a>
                    </li>

                    <li class="page-item" th:classappend="${paginaActual + 1 == totalPaginas} ? 'disabled'">
                        <a class="page-link" href="javascript:void(0);"
                           th:onclick="'cargarComponenteConPagina(\'huespedes\', ' + (${paginaActual} + 1) + ')'">
                            Siguiente
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>

    <!-- ========== MODALES ========== -->

    <!-- Modal Crear -->
    <div class="modal fade" id="modalCrear" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-plus-circle me-2"></i>Nuevo Huesped
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>

                <!-- CAMBIO 1: Quitar th:action y th:object, usar onsubmit -->
                <form id="formCrear" onsubmit="event.preventDefault(); crearHuespedAJAX(this);">
                    <div class="modal-body">
                        <!-- CAMBIO 2: Agregar contenedor para mensajes -->
                        <div id="mensajeCrear" class="alert" style="display:none;"></div>

                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Nombres *</label>
                                <!-- CAMBIO 3: Usar name en lugar de th:field -->
                                <input type="text" class="form-control"
                                       name="nombres" required
                                       placeholder="Jhon Doe">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Apellidos *</label>
                                <!-- CAMBIO 3: Usar name en lugar de th:field -->
                                <input type="text" class="form-control"
                                       name="apellidos" required
                                       placeholder="Carter">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Tipo de documento *</label>
                                <!-- CAMBIO 4: Usar name en lugar de th:field -->
                                <select class="form-select" name="idTipoDocumento" required>
                                    <option value="">Seleccione un tipo</option>
                                    <option value="1">Cedula</option>
                                    <option value="2">Pasaporte</option>
                                    <option value="3">DNI</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Documento *</label>
                                <!-- CAMBIO 3: Usar name en lugar de th:field -->
                                <input type="text" class="form-control"
                                       name="documento" required
                                       placeholder="Carter">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Email *</label>
                                <!-- CAMBIO 3: Usar name en lugar de th:field -->
                                <input type="text" class="form-control"
                                       name="email" required
                                       placeholder="jhondoe@gmail.com">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Telefono *</label>
                                <!-- CAMBIO 3: Usar name en lugar de th:field -->
                                <input type="text" class="form-control"
                                       name="telefono" required
                                       placeholder="453423">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Direccion *</label>
                                <!-- CAMBIO 3: Usar name en lugar de th:field -->
                                <input type="text" class="form-control"
                                       name="direccion" required
                                       placeholder="453423">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Estado *</label>
                                <!-- CAMBIO 4: Usar name en lugar de th:field -->
                                <select class="form-select" name="idEstado" required>
                                    <option value="">Seleccione un tipo</option>
                                    <option value="1">Activo</option>
                                    <option value="2">En deuda</option>
                                    <option value="3">En estadia</option>
                                    <option value="4">Salida</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <!-- CAMBIO 5: Cambiar type="submit" a type="button" y manejar con JS -->
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-success" id="btnCrear">
                            <span id="btnCrearTexto">Guardar</span>
                            <span id="btnCrearSpinner" class="spinner-border spinner-border-sm"
                                  style="display:none;"></span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Editar -->
    <div class="modal fade" id="modalEditar" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-edit me-2"></i>Editar Huesped
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>

                <!-- CAMBIO 1: Quitar action, usar onsubmit -->
                <form id="formEditar" onsubmit="event.preventDefault(); actualizarHuespedAJAX(this);">
                    <div class="modal-body" id="contenidoEditar">
                        <!-- Contenido cargado din치micamente por JavaScript -->
                        <div class="text-center py-4">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Cargando...</span>
                            </div>
                            <p class="mt-2">Cargando datos del huesped...</p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-primary" id="btnActualizar">
                            <span id="btnActualizarTexto">Actualizar</span>
                            <span id="btnActualizarSpinner" class="spinner-border spinner-border-sm"
                                  style="display:none;"></span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Ver Detalles -->
    <div class="modal fade" id="modalVer" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-info text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-eye me-2"></i>Detalles de Huesped
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="contenidoVer">
                    <!-- Contenido cargado din치micamente -->
                    <div class="text-center py-4">
                        <div class="spinner-border text-info" role="status">
                            <span class="visually-hidden">Cargando...</span>
                        </div>
                        <p class="mt-2">Cargando detalles...</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>
</div>

